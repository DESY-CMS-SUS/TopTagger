<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>TopTagger: Tagger development tools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TopTagger
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tagger development tools </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We use Tensorflow package for MVA based tagger studies. The training/validation is python based. The model is integrated into the c++ side of the framework via the Tensorflow c-api or through a call to python if the Tensorflow c-api is inavaliable.</p>
<h2>Samples for training and validation</h2>
<p>Slimmed tuples containing only the information needed for training and validation can be made with "cpp/makeTrainingTuples.C". The training and validation currently require input from several samples including semileptonic ttbar, QCD, and znunu. The instructions for creating these files are found below.</p>
<p>Run the following commands (at the LPC)</p>
<div class="fragment"><div class="line">make </div>
<div class="line">./makeTrainingTuples -D TTbarSingleLep -E 550000 -R 10:1</div>
<div class="line">./makeTrainingTuples -D ZJetsToNuNu -E 200000 -R 1:1</div>
</div><!-- fragment --><p>You can change the input sample name with -D, #events with -E and ratio (training sample to validation sample) with -R. Additional sample splits can be added with -R (i.e. -R 2:2:1 will create 3 sample files where the first 2 have twice the number of events as the 3rd). To produce the training files for an entire dataset a condor submit script is provided in condor/condorSubmit.py. This code requires the repository "susy2015/SusyAnaTools" to be checked out in the same directory as the <a class="el" href="classTopTagger.html">TopTagger</a> repository to compile and run.</p>
<h2>Running ANN training code</h2>
<p>The following packages must be installed on your system if you wish to train a model with tensorflow</p>
<h3>Required packages</h3>
<p>The following packages much be installed to run the ANN training and validation code</p>
<h4>python 2.7</h4>
<p><a href="https://www.python.org/">https://www.python.org/</a></p>
<h4>virtualenv</h4>
<p>This package is not manditory, but is highly recomended to isolate all the packages you will install from your main python installation</p>
<p><a href="https://virtualenv.pypa.io/en/stable/">https://virtualenv.pypa.io/en/stable/</a></p>
<p>To install other packages in the virtual environment first source the activate script for the virtual environment of interest and then install the following packages via pip.</p>
<h4>scipy &amp; numpy</h4>
<p>scipy and numpy are used for efficient manipulation of large datasets in python and are prerequisutes for most other packages required</p>
<p><a href="https://www.scipy.org/install.html">https://www.scipy.org/install.html</a></p>
<p><a href="https://www.scipy.org/install.html">https://www.scipy.org/install.html</a></p>
<h4>pandas</h4>
<p>Pandas is a package which is designed to make manipulation of datasets in python more convinenent</p>
<p><a href="http://pandas.pydata.org/pandas-docs/stable/">http://pandas.pydata.org/pandas-docs/stable/</a></p>
<h4>scikit-learn</h4>
<p>Scikit learn is a python package which implements a wide array of easy to use MVA techniques</p>
<p><a href="http://scikit-learn.org/stable/install.html">http://scikit-learn.org/stable/install.html</a></p>
<h4>tensorflow</h4>
<p>Tensorflow is the machine learning package developed by Google for implementing and training a wide range of advanced neural networks.</p>
<p><a href="https://www.tensorflow.org/install/">https://www.tensorflow.org/install/</a></p>
<h4>HDF5</h4>
<p>HDF5 is a dataformat which we use to hold the training and validation format. This package is a pain to install. Unless you have a redhat based linux intall it must be installed from source</p>
<p><a href="https://support.hdfgroup.org/HDF5/release/obtainsrc518.html">https://support.hdfgroup.org/HDF5/release/obtainsrc518.html</a></p>
<p>Then the python interface must be installed seperately</p>
<p><a href="http://docs.h5py.org/en/latest/build.html">http://docs.h5py.org/en/latest/build.html</a></p>
<p>When I installed the main HD5 package from source I found it named the libraries in a way that the python library couldn't find. I was able to workaround this by creating the following softlinks</p>
<p>libhdf5.so -&gt; libhdf5-shared.so libhdf5_hl.so -&gt; libhdf5_hl-shared.so</p>
<h4>ROOT and PyROOT</h4>
<p><a href="https://root.cern.ch/downloading-root">https://root.cern.ch/downloading-root</a></p>
<h3>Training</h3>
<p>The script "Training.py" is used to train produce and train the MVA algorithm. The script is primarily intended to train neural networks with tensorflow, but it also is able to train random forests with scikit learn and boosted decision trees with the extreme gradient boost package. To run a basic training using the kodiak gpu machines (gpu001 or gpu002) with the default varialbes the following commands can be run.</p>
<div class="fragment"><div class="line">cd <a class="code" href="classTopTagger.html">TopTagger</a>/Tools/python</div>
<div class="line">source source ~hatake/tensorflow/setup.sh</div>
<div class="line">python Training.py -d DIRECTORY</div>
</div><!-- fragment --><p>This will train a tensorflow model with the default settings. Note that in the case of a neural network training this can take many hours. To do a "quick" (~15 to 30 min) test use the "-e 2" option to limit yourself to only two training epochs. The results will appear in "DIRECTORY". The immediate validation can be viewed during or after training by launching tensorboard as follows</p>
<div class="fragment"><div class="line">tensorboard --logdir DIRECTORY</div>
</div><!-- fragment --><p>This can then be viewed by tuneling your browser to the machine where tensorboard is running and navigating to "localhost:6006". You can also copy the directory "DIRECTORY" to your local machine and run the same tensorboard command to view this information on your local machine.</p>
<p>Training parameters defaulta can be seen and modified by looking in the file "TopTagger/Tools/python/taggerOptions.py".</p>
<h3>Validation</h3>
<p>The script "Validation.py" produces a series of validation plots including plots of all MVA input variables, the output discriminator, purity, fake rate, efficiency, and ROC curves. It also produces a version of the ROC curve in a pkl file for reploting. The validation code will look for the trained network file in the directory specified with the -d option, so this should be the same directory name given to the training script. Additionally, the output files will b ewritten to this directoty.</p>
<div class="fragment"><div class="line">python Validation.py -d DIRECTORY</div>
</div><!-- fragment --><p>No other options are necessary as all settings needed are read from the configuration file written in DIRECTORY by the training script.</p>
<h3>Combined ROC curve plots</h3>
<p>The script "rocPlots.py" is provided to help many compairson ROC plots to draw multiple ROC curves on the same axis. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 2 2019 22:36:00 for TopTagger by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
